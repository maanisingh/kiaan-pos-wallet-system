# Deployment Guide - Kiaan POS & Wallet System

## Quick Deploy to Railway (Admin Dashboard)

### Prerequisites
- Railway account ([railway.app](https://railway.app))
- GitHub account (already done âœ…)
- Supabase account (for hosted database) or use local Supabase

### Step 1: Install Railway CLI

```bash
npm install -g @railway/cli
```

### Step 2: Login to Railway

```bash
railway login
```

### Step 3: Deploy from GitHub

1. Go to [railway.app/new](https://railway.app/new)
2. Select "Deploy from GitHub repo"
3. Choose: `maanisingh/kiaan-pos-wallet-system`
4. Railway will auto-detect the monorepo

### Step 4: Configure Service

1. **Select Root Directory:** `/apps/admin`
2. **Build Command:** `cd ../.. && pnpm install && pnpm build --filter=admin`
3. **Start Command:** `cd apps/admin && pnpm start`

### Step 5: Set Environment Variables

In Railway dashboard, add these variables:

```env
NEXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key
NEXT_PUBLIC_APP_URL=https://your-app.railway.app
NODE_ENV=production
```

### Step 6: Deploy!

Railway will automatically deploy. Your admin dashboard will be live at:
`https://your-app.railway.app`

---

## Alternative: Deploy via CLI

```bash
# From project root
cd /root/kiaan-pos-wallet-system

# Login to Railway
railway login

# Initialize Railway project
railway init

# Link to service
railway link

# Set environment variables
railway variables set NEXT_PUBLIC_SUPABASE_URL=your-url
railway variables set NEXT_PUBLIC_SUPABASE_ANON_KEY=your-key
railway variables set SUPABASE_SERVICE_ROLE_KEY=your-service-key

# Deploy
railway up --service admin
```

---

## Supabase Setup (Hosted)

### Option 1: Use Supabase Cloud (Recommended for Production)

1. Go to [supabase.com](https://supabase.com)
2. Create new project
3. Wait for database to provision
4. Go to Project Settings â†’ API
5. Copy:
   - `URL` â†’ `NEXT_PUBLIC_SUPABASE_URL`
   - `anon public` â†’ `NEXT_PUBLIC_SUPABASE_ANON_KEY`
   - `service_role` â†’ `SUPABASE_SERVICE_ROLE_KEY`

### Option 2: Self-Host Supabase (Free)

```bash
# Clone Supabase
git clone https://github.com/supabase/supabase
cd supabase/docker

# Start Supabase
docker-compose up -d

# Get credentials
docker-compose exec supabase-db psql -U postgres -c "SELECT 'postgresql://postgres:postgres@localhost:5432/postgres'"
```

---

## Database Migration

### Using Supabase Cloud

```bash
# Install Supabase CLI
pnpm add -g supabase

# Login
supabase login

# Link to your project
supabase link --project-ref your-project-ref

# Push migrations
supabase db push

# Seed database
supabase db seed
```

### Manual Migration

Copy the SQL from `supabase/migrations/20250122000000_initial_schema.sql` and run it in:
- Supabase Dashboard â†’ SQL Editor â†’ New Query

Then run `supabase/seed.sql` for test data.

---

## Verification

After deployment:

1. Visit your Railway URL
2. Should see "Kiaan POS Dashboard"
3. All stats cards should be visible
4. All client specifications should be met

---

## Monitoring

### Railway Dashboard
- View logs: `railway logs`
- View metrics: Railway Dashboard â†’ Metrics
- Set up alerts in Railway settings

### Supabase Dashboard
- Monitor database performance
- View API requests
- Check real-time connections

---

## Cost Estimate

### Free Tier
- Railway: $5/month (Hobby plan)
- Supabase: Free up to 500MB database
- GitHub: Free for public repos
- **Total: ~$5/month**

### Production Tier
- Railway: ~$20/month (Pro plan with resources)
- Supabase: ~$25/month (Pro plan)
- **Total: ~$45/month**

---

## Custom Domain (Optional)

### Add Custom Domain in Railway

1. Railway Dashboard â†’ Settings â†’ Domains
2. Add custom domain (e.g., `admin.kiaan.com`)
3. Add CNAME record in your DNS:
   ```
   admin.kiaan.com â†’ your-app.railway.app
   ```
4. SSL certificate is auto-generated by Railway

---

## Troubleshooting

### Build Fails
```bash
# Check build logs
railway logs --build

# Common fix: Clear cache
railway up --detach
```

### Environment Variables Not Working
```bash
# List all variables
railway variables

# Re-set variables
railway variables set KEY=value
```

### Database Connection Issues
- Verify Supabase URL is correct
- Check if Supabase project is running
- Test connection with `supabase db ping`

---

## CI/CD (GitHub Actions)

Auto-deploy on push is configured in `.github/workflows/deploy.yml` (to be added).

Railway automatically deploys on git push if connected to GitHub repo.

---

## Next Steps After Deployment

1. **Setup Supabase Auth** for admin login
2. **Configure Email** for notifications
3. **Setup Mobile Money APIs** (MTN/Airtel)
4. **Build Mobile App** with Expo EAS
5. **Distribute POS Terminal App**

---

## Support

- Railway Docs: https://docs.railway.app
- Supabase Docs: https://supabase.com/docs
- GitHub Issues: https://github.com/maanisingh/kiaan-pos-wallet-system/issues

---

**Your admin dashboard is now live! ðŸš€**
