# Railway Deployment - Complete Guide

## ‚úÖ Step 1: Fix Applied

The missing `pnpm-lock.yaml` has been added and pushed to GitHub.

Railway will automatically redeploy in 2-3 minutes.

---

## ‚ö†Ô∏è Step 2: Set Environment Variables (REQUIRED)

Your deployment will fail without these environment variables!

### In Railway Dashboard:

1. Go to: https://railway.app/project/ingenious-reverence
2. Click on **admin** service
3. Go to **Variables** tab
4. Click **+ New Variable**
5. Add each of these:

```env
NEXT_PUBLIC_SUPABASE_URL=your-supabase-url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key
NODE_ENV=production
```

---

## Getting Supabase Credentials

### Option A: Supabase Cloud (Recommended)

1. **Sign up:** [supabase.com](https://supabase.com)
2. **Create new project:**
   - Name: `kiaan-pos-wallet`
   - Database Password: (save this!)
   - Region: Choose closest to your users
3. **Wait 2 minutes** for database to provision
4. **Get credentials:**
   - Go to: **Project Settings** ‚Üí **API**
   - Copy:
     - `URL` ‚Üí `NEXT_PUBLIC_SUPABASE_URL`
     - `anon public` ‚Üí `NEXT_PUBLIC_SUPABASE_ANON_KEY`
     - `service_role` ‚Üí `SUPABASE_SERVICE_ROLE_KEY`

5. **Apply database schema:**
```bash
# Install Supabase CLI
npm install -g supabase

# Login
supabase login

# Link to your project
supabase link --project-ref YOUR-PROJECT-REF

# Push database schema
supabase db push

# Seed test data
supabase db seed
```

**Your PROJECT-REF is in the URL:**
`https://supabase.com/dashboard/project/YOUR-PROJECT-REF`

### Option B: Self-Hosted Supabase (Free)

1. **Clone Supabase:**
```bash
git clone https://github.com/supabase/supabase
cd supabase/docker
```

2. **Start Supabase:**
```bash
docker-compose up -d
```

3. **Get credentials:**
```bash
# API URL
echo "http://YOUR-SERVER-IP:54321"

# Anon Key (from Kong container)
docker-compose exec kong cat /etc/kong/kong.yml | grep anon

# Service Role Key
docker-compose exec kong cat /etc/kong/kong.yml | grep service_role
```

4. **Apply schema:**
```bash
# Copy schema to Supabase container
docker cp ../migrations/20250122000000_initial_schema.sql supabase-db:/tmp/

# Execute schema
docker exec supabase-db psql -U postgres -d postgres -f /tmp/20250122000000_initial_schema.sql

# Execute seed
docker cp ../seed.sql supabase-db:/tmp/
docker exec supabase-db psql -U postgres -d postgres -f /tmp/seed.sql
```

---

## Step 3: Verify Deployment

After Railway finishes deploying (watch **Deployments** tab):

1. **Click the deployment URL** (looks like: `https://admin-production-XXXX.up.railway.app`)
2. **You should see:**
   - ‚úÖ Kiaan POS Dashboard heading
   - ‚úÖ 4 stats cards
   - ‚úÖ System features list
   - ‚úÖ Client specifications

3. **If you see errors:**
   - Check Railway **Deploy Logs** tab
   - Common issues:
     - Missing environment variables
     - Supabase URL not accessible
     - Invalid API keys

---

## Step 4: Add Custom Domain (Optional)

1. **In Railway Dashboard:**
   - Settings ‚Üí **Domains**
   - Click **+ Custom Domain**
   - Enter: `admin.kiaan.com` (or your domain)

2. **In your DNS provider:**
   - Add CNAME record:
   ```
   admin.kiaan.com ‚Üí admin-production-XXXX.up.railway.app
   ```

3. **Wait 5 minutes** for DNS propagation

4. **SSL certificate** is auto-generated by Railway

---

## Monitoring & Logs

### View Logs:
```bash
# Install Railway CLI
npm install -g @railway/cli

# Login
railway login

# View logs
railway logs --service admin
```

### Or in Dashboard:
- Go to service ‚Üí **Observability** tab
- View **Logs** in real-time
- Check **Metrics** (CPU, Memory, Network)

---

## Troubleshooting

### Build Fails Again?

**Check these:**

1. ‚úÖ `pnpm-lock.yaml` exists in repo
2. ‚úÖ Environment variables are set
3. ‚úÖ Supabase is accessible from Railway

**Clear build cache:**
```bash
railway up --detach
```

### Database Connection Fails?

**Test Supabase connection:**
```bash
curl https://YOUR-SUPABASE-URL/rest/v1/ \
  -H "apikey: YOUR-ANON-KEY"
```

Should return: `{"message":"Welcome to PostgREST"}`

### App Loads But No Data?

**Verify database schema:**
```bash
supabase db pull
# Should show all 7 tables
```

---

## Alternative: Deploy to Vercel (If Railway Issues)

Railway having issues? Deploy to Vercel instead:

```bash
# Install Vercel CLI
npm install -g vercel

# Deploy
cd apps/admin
vercel

# Follow prompts
# Set same environment variables in Vercel dashboard
```

---

## Cost & Scaling

### Railway Pricing:
- **Hobby Plan:** $5/month
  - 512MB RAM
  - 1GB disk
  - Enough for 100+ concurrent users

- **Pro Plan:** ~$20/month
  - 8GB RAM
  - 100GB disk
  - Auto-scaling
  - Recommended for production

### Supabase Pricing:
- **Free Tier:**
  - 500MB database
  - 2GB bandwidth/month
  - Enough for testing

- **Pro Plan:** $25/month
  - 8GB database
  - 50GB bandwidth/month
  - Daily backups
  - Recommended for production

---

## Health Check

Once deployed, test these URLs:

1. **Homepage:**
   `https://your-app.railway.app`
   - Should load dashboard

2. **API Health:**
   `https://YOUR-SUPABASE-URL/rest/v1/`
   - Should return PostgREST welcome

3. **Test Query:**
   ```bash
   curl https://YOUR-SUPABASE-URL/rest/v1/branches \
     -H "apikey: YOUR-ANON-KEY"
   ```
   - Should return branches array

---

## Next Steps After Successful Deploy

1. ‚úÖ **Test Admin Dashboard** - Browse all pages
2. ‚úÖ **Add Authentication** - Implement Supabase Auth
3. ‚úÖ **Create Admin User** - First admin account
4. ‚úÖ **Test Card Creation** - Create test card
5. ‚úÖ **Test Transactions** - Simulate purchase
6. ‚úÖ **Configure MTN/Airtel** - Add payment APIs
7. ‚úÖ **Build Mobile App** - Start Expo development
8. ‚úÖ **Build POS Terminal** - Start Tauri development

---

## Support

- **Railway Docs:** https://docs.railway.app
- **Supabase Docs:** https://supabase.com/docs
- **GitHub Issues:** https://github.com/maanisingh/kiaan-pos-wallet-system/issues

---

**Current Status:** ‚úÖ pnpm-lock.yaml added
**Next:** Set environment variables in Railway
**ETA:** 5 minutes to full deployment

**Railway will auto-deploy when you push changes to GitHub!** üöÄ
